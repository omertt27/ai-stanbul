INFO:     Will watch for changes in these directories: ['/Users/omer/Desktop/ai-stanbul/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [246] using StatReload
2026-01-22 17:22:15,473 - database - INFO - âœ… Using centralized database configuration
2026-01-22 17:22:15,473 - config.database_config - INFO - ============================================================
2026-01-22 17:22:15,473 - config.database_config - INFO - DATABASE CONFIGURATION
2026-01-22 17:22:15,473 - config.database_config - INFO - ============================================================
2026-01-22 17:22:15,473 - config.database_config - INFO - Database Type: POSTGRESQL
2026-01-22 17:22:15,473 - config.database_config - INFO - Host: localhost
2026-01-22 17:22:15,473 - config.database_config - INFO - Port: 5433
2026-01-22 17:22:15,473 - config.database_config - INFO - Database: ai_istanbul
2026-01-22 17:22:15,473 - config.database_config - INFO - Username: postgres
2026-01-22 17:22:15,473 - config.database_config - INFO - Render PostgreSQL: No
2026-01-22 17:22:15,473 - config.database_config - INFO - SSL Enabled: No
2026-01-22 17:22:15,473 - config.database_config - INFO - ============================================================
2026-01-22 17:22:15,501 - database - INFO - ï¿½ PostgreSQL engine created with connection pooling
2026-01-22 17:22:15,501 - database - INFO - ============================================================
2026-01-22 17:22:15,501 - database - INFO - ğŸ“Š DATABASE BACKEND INFORMATION
2026-01-22 17:22:15,501 - database - INFO -    Type: postgresql
2026-01-22 17:22:15,501 - database - INFO -    Driver: psycopg2
2026-01-22 17:22:15,501 - database - INFO -    Database: ai_istanbul
2026-01-22 17:22:15,501 - database - INFO -    Host: localhost
2026-01-22 17:22:15,501 - database - INFO -    Port: 5433
2026-01-22 17:22:15,501 - database - INFO -    Pool: QueuePool
2026-01-22 17:22:15,501 - database - INFO - ============================================================
2026-01-22 17:22:16,152 - services.llm.context - INFO - âœ… Industry-level Transportation RAG system available
2026-01-22 17:22:16,154 - services.llm.context - INFO - âœ… Istanbul Knowledge RAG system available
2026-01-22 17:22:16,269 - api.admin.routes - INFO - âœ… Admin routes initialized
2026-01-22 17:22:16,273 - services.smart_feedback_processor - INFO - ğŸ“ Feedback data directory: /Users/omer/Desktop/ai-stanbul/backend/training_data
2026-01-22 17:22:16,389 - ttl_fine_tuning - INFO - ğŸ”§ TTL Optimizer initialized with dynamic fine-tuning
2026-01-22 17:22:16,389 - google_api_integration - INFO - âœ… TTL fine-tuning system loaded
2026-01-22 17:22:16,390 - core.startup_guard - INFO - âœ… Redis readiness check: CONNECTED
2026-01-22 17:22:16,390 - google_api_integration - INFO - âœ… Time-aware cache using centralized Redis client
2026-01-22 17:22:16,392 - integrated_cache_system - INFO - âœ… Production cache monitor using centralized Redis client
2026-01-22 17:22:16,392 - integrated_cache_system - INFO - ğŸ”„ Production cache monitoring started
2026-01-22 17:22:16,392 - integrated_cache_system - INFO - ğŸ’¾ Cache hit rate: 0.0% (warming up)
2026-01-22 17:22:16,392 - integrated_cache_system - INFO - ğŸ“Š Cache metrics: 0.0% hit rate, 0ms avg response, $0.00 saved
2026-01-22 17:22:16,393 - integrated_cache_system - INFO - ğŸ”¥ Cache warming service started
2026-01-22 17:22:16,393 - integrated_cache_system - INFO - ğŸš€ Integrated Cache System initialized successfully
2026-01-22 17:22:16,395 - integrated_cache_system - ERROR - âŒ Error warming query 'best restaurants in Sultanahmet': Google API key not configured
2026-01-22 17:22:16,396 - integrated_cache_system - ERROR - âŒ Error warming query 'vegetarian restaurants in Karakoy': Google API key not configured
2026-01-22 17:22:16,396 - integrated_cache_system - ERROR - âŒ Error warming query 'fine dining Istanbul': Google API key not configured
2026-01-22 17:22:16,397 - backend.database - INFO - âœ… Using centralized database configuration
2026-01-22 17:22:16,397 - integrated_cache_system - ERROR - âŒ Error warming query 'seafood restaurants near Bosphorus': Google API key not configured
2026-01-22 17:22:16,397 - integrated_cache_system - ERROR - âŒ Error warming query 'Turkish street food': Google API key not configured
2026-01-22 17:22:16,398 - config.database_config - INFO - ============================================================
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'Turkish breakfast places in BeyoÄŸlu': Google API key not configured
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'family friendly restaurants': Google API key not configured
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'cheap eats in Kadikoy': Google API key not configured
2026-01-22 17:22:16,398 - config.database_config - INFO - DATABASE CONFIGURATION
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'restaurants open late night': Google API key not configured
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'romantic dinner places Istanbul': Google API key not configured
2026-01-22 17:22:16,398 - integrated_cache_system - ERROR - âŒ Error warming query 'best kebab places in Istanbul': Google API key not configured
2026-01-22 17:22:16,399 - integrated_cache_system - ERROR - âŒ Error warming query 'rooftop restaurants with view': Google API key not configured
2026-01-22 17:22:16,399 - integrated_cache_system - ERROR - âŒ Error warming query 'restaurants with live music': Google API key not configured
2026-01-22 17:22:16,399 - config.database_config - INFO - ============================================================
2026-01-22 17:22:16,399 - integrated_cache_system - ERROR - âŒ Error warming query 'halal restaurants near Hagia Sophia': Google API key not configured
2026-01-22 17:22:16,399 - integrated_cache_system - ERROR - âŒ Error warming query 'traditional Turkish restaurants': Google API key not configured
2026-01-22 17:22:16,399 - config.database_config - INFO - Database Type: POSTGRESQL
2026-01-22 17:22:16,399 - config.database_config - INFO - Host: localhost
2026-01-22 17:22:16,399 - config.database_config - INFO - Port: 5433
2026-01-22 17:22:16,399 - config.database_config - INFO - Database: ai_istanbul
2026-01-22 17:22:16,399 - config.database_config - INFO - Username: postgres
2026-01-22 17:22:16,399 - config.database_config - INFO - Render PostgreSQL: No
2026-01-22 17:22:16,399 - config.database_config - INFO - SSL Enabled: No
2026-01-22 17:22:16,399 - config.database_config - INFO - ============================================================
2026-01-22 17:22:16,400 - backend.database - INFO - ï¿½ PostgreSQL engine created with connection pooling
2026-01-22 17:22:16,400 - backend.database - INFO - ============================================================
2026-01-22 17:22:16,400 - backend.database - INFO - ğŸ“Š DATABASE BACKEND INFORMATION
2026-01-22 17:22:16,400 - backend.database - INFO -    Type: postgresql
2026-01-22 17:22:16,400 - backend.database - INFO -    Driver: psycopg2
2026-01-22 17:22:16,400 - backend.database - INFO -    Database: ai_istanbul
2026-01-22 17:22:16,400 - backend.database - INFO -    Host: localhost
2026-01-22 17:22:16,400 - backend.database - INFO -    Port: 5433
2026-01-22 17:22:16,400 - backend.database - INFO -    Pool: QueuePool
2026-01-22 17:22:16,400 - backend.database - INFO - ============================================================
2026-01-22 17:22:16,400 - integrated_cache_system - INFO - ğŸ”¥ Cache warming completed: 0/15 queries warmed
2026-01-22 17:22:16,644 - api_clients.google_analytics_api - WARNING - Google Analytics Data API not available. Install with: pip install google-analytics-data
2026-01-22 17:22:16,645 - api_clients.enhanced_google_places - WARNING - Google Places API: Using fallback mode with enhanced mock data.
2026-01-22 17:22:16,949 - routes.blog - INFO - Blog router initialized successfully
2026-01-22 17:22:16,949 - core.middleware - INFO - âœ… CORS middleware configured
2026-01-22 17:22:16,949 - core.security - INFO - âœ… Security middleware configured
2026-01-22 17:22:16,949 - core.errors - INFO - âœ… Standardized error handlers configured
2026-01-22 17:22:16,949 - core.middleware - INFO - âœ… All middleware configured
2026-01-22 17:22:16,949 - main_modular - INFO - âœ… Static files mounted at /static -> /Users/omer/Desktop/ai-stanbul/backend/static
2026-01-22 17:22:16,959 - main_modular - INFO - âœ… Streaming API registered at /api/stream
2026-01-22 17:22:16,960 - main_modular - INFO - âœ… Feedback API registered at /api/feedback
2026-01-22 17:22:16,962 - main_modular - INFO - âœ… Direct Routing API registered at /api/routes
2026-01-22 17:22:16,962 - main_modular - INFO - ğŸ“‹ Admin routes router has 10 routes
2026-01-22 17:22:16,964 - main_modular - INFO - âœ… Admin routes registered at /api/admin
2026-01-22 17:22:16,968 - main_modular - INFO - âœ… Blog API registered at /api/blog
2026-01-22 17:22:16,969 - main_modular - INFO - âœ… Cache monitoring routes registered at /api/cache
2026-01-22 17:22:16,970 - main_modular - INFO - âœ… Intent feedback routes registered at /api/feedback
2026-01-22 17:22:17,012 - main_modular - INFO - âœ… Legacy routes registered
INFO:     Started server process [300]
INFO:     Waiting for application startup.
2026-01-22 17:22:17,021 - core.startup_guard - INFO - âœ… lifespan_startup marked as initialized
2026-01-22 17:22:17,021 - main_modular - INFO - ğŸš€ Starting application (non-blocking startup)
2026-01-22 17:22:17,021 - main_modular - INFO - ğŸ“¡ Redis status: CONNECTED
2026-01-22 17:22:17,021 - main_modular - INFO - âœ… Application ready to accept connections (background init in progress)
2026-01-22 17:22:17,021 - core.startup_guard - INFO - âœ… background_init marked as initialized
2026-01-22 17:22:17,035 - main_modular - INFO - ğŸ”„ Starting background initialization...
2026-01-22 17:22:17,035 - core.startup_guard - INFO - âœ… startup_manager marked as initialized
2026-01-22 17:22:17,035 - core.startup_fixed - INFO - ï¿½ğŸš€ Starting ULTRA-FAST initialization...
2026-01-22 17:22:17,035 - core.startup_fixed - INFO - âœ… App ready to serve traffic - components initializing in background!
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO - ğŸš€ LLM Client initialized
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    Type: openai-compatible
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    URL: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    API Key: None
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    Timeout: 60.0s
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    Max Tokens: 768
2026-01-22 17:22:17,040 - services.runpod_llm_client - INFO -    Connection Pool: 10 max, 5 keepalive
2026-01-22 17:22:17,040 - services.llm.prompts - INFO - âœ… Prompt Builder initialized
2026-01-22 17:22:17,040 - unified_system.services.unified_llm_service - INFO - âœ… Unified LLM Service - components loaded
2026-01-22 17:22:17,040 - unified_system.services.unified_llm_service - INFO - âœ… Unified LLM Service initialized (ENABLED)
2026-01-22 17:22:17,040 - unified_system.services.unified_llm_service - INFO -    Cache: âœ…
2026-01-22 17:22:17,040 - unified_system.services.unified_llm_service - INFO -    Circuit Breaker: âœ…
2026-01-22 17:22:17,040 - main_modular - INFO - âœ… UnifiedLLMService initialized and ready for API layer
2026-01-22 17:22:17,040 - main_modular - INFO - ğŸ“¡ RunPod LLM endpoint: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1
2026-01-22 17:22:17,040 - main_modular - INFO - ğŸ¤– Model: /workspace/models/llama-3.1-8b-fp16
2026-01-22 17:22:17,040 - main_modular - INFO - ğŸ’¾ Cache: enabled (0/1000 entries)
2026-01-22 17:22:17,040 - main_modular - INFO - ğŸ›¡ï¸  Circuit breaker: enabled (threshold=5)
2026-01-22 17:22:17,040 - services.llm.ab_testing - INFO - âœ… ExperimentManager initialized
2026-01-22 17:22:17,040 - api.admin.experiments - INFO - âœ… Experiment Manager initialized
2026-01-22 17:22:17,042 - services.llm.feature_flags - INFO - âœ… FeatureFlagManager initialized
2026-01-22 17:22:17,042 - api.admin.experiments - INFO - âœ… Feature Flag Manager initialized
2026-01-22 17:22:17,042 - main_modular - INFO - âœ… Admin experiment managers initialized
2026-01-22 17:22:17,042 - main_modular - INFO - âœ… Background initialization complete!
INFO:     Application startup complete.
2026-01-22 17:22:17,042 - core.startup_guard - INFO - âœ… database marked as initialized
2026-01-22 17:22:17,042 - core.startup_fixed - INFO - ğŸ”„ Registering database models...
2026-01-22 17:22:17,042 - database - INFO - âœ… Registered 24 database models
2026-01-22 17:22:17,042 - core.startup_fixed - INFO - ğŸ”„ Creating database tables if needed...
2026-01-22 17:22:19,694 - core.startup_fixed - INFO - âœ… Database tables ready
2026-01-22 17:22:19,694 - core.startup_fixed - INFO - âœ… Database connection established
2026-01-22 17:22:19,694 - core.startup_guard - INFO - âœ… redis marked as initialized
2026-01-22 17:22:19,695 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:22:19,695 - core.startup_guard - INFO - âœ… services marked as initialized
2026-01-22 17:22:19,695 - services.service_manager - INFO - ğŸ”§ Initializing Service Manager...
2026-01-22 17:22:19,695 - services.service_manager - INFO - ğŸ“¦ Loading Istanbul AI services...
2026-01-22 17:22:19,699 - services.service_manager - INFO - âœ… Restaurant service loaded
2026-01-22 17:22:19,705 - services.transportation_directions_service - INFO - âœ… Backend OSRM routing service imported successfully
2026-01-22 17:22:19,707 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine imported successfully
2026-01-22 17:22:19,707 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:22:19,708 - services.osrm_routing_service - INFO - âœ… OSRM routing cache enabled (Redis)
2026-01-22 17:22:19,709 - services.osrm_routing_service - INFO - OSRM Routing Service initialized (server: primary, profile: foot, cache: True)
2026-01-22 17:22:19,709 - services.transportation_directions_service - INFO - âœ… OSRM service initialized successfully
2026-01-22 17:22:19,709 - services.graph_routing_engine - INFO - ğŸ—ï¸ Building Istanbul transportation graph...
2026-01-22 17:22:19,710 - services.graph_routing_engine - INFO - ğŸ”„ Adding transfer connections...
2026-01-22 17:22:19,710 - services.graph_routing_engine - INFO - âœ… Added 154 transfer connections
2026-01-22 17:22:19,710 - services.graph_routing_engine - INFO - âœ… Graph built: 208 nodes, 528 edges
2026-01-22 17:22:19,710 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine initialized successfully
2026-01-22 17:22:19,710 - services.transportation_directions_service - INFO - âœ… Transportation Directions Service initialized
2026-01-22 17:22:19,710 - services.service_manager - INFO - âœ… Transportation service loaded
2026-01-22 17:22:19,711 - services.service_manager - INFO - âœ… Hidden gems service loaded
2026-01-22 17:22:19,713 - services.events_service - INFO - âœ… Loaded 45 Ä°KSV events from database
2026-01-22 17:22:19,713 - services.service_manager - INFO - âœ… Events service loaded
2026-01-22 17:22:19,714 - services.service_manager - INFO - âœ… Attractions service loaded
2026-01-22 17:22:19,715 - services.airport_transport_service - INFO - âœˆï¸ Istanbul Airport Transport Service initialized
2026-01-22 17:22:19,715 - services.airport_transport_service - INFO - âœˆï¸ Istanbul Airport Transport Service initialized
2026-01-22 17:22:19,715 - services.service_manager - INFO - âœ… Airport transport service loaded
2026-01-22 17:22:19,717 - services.service_manager - INFO - âœ… Daily life service loaded
2026-01-22 17:22:19,721 - services.service_manager - INFO - âœ… Info retrieval service loaded
2026-01-22 17:22:19,721 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:22:19,721 - api_clients.enhanced_weather - INFO - âœ… Weather API: Using Redis cache (persistent across restarts)
2026-01-22 17:22:19,721 - api_clients.enhanced_weather - WARNING - Weather API: Using fallback mode with enhanced mock data.
2026-01-22 17:22:19,721 - services.service_manager - INFO - âœ… Enhanced weather service loaded (real API with OpenWeatherMap)
2026-01-22 17:22:19,722 - services.entity_extractor - INFO - âœ… AdvancedEntityExtractor initialized
2026-01-22 17:22:19,722 - services.service_manager - INFO - âœ… Entity extractor loaded
2026-01-22 17:22:20,268 - services.enhanced_intent_classifier - WARNING - Smart fallback system not available
2026-01-22 17:22:20,273 - services.enhanced_intent_classifier - INFO - âœ… ML intent classifier trained successfully
2026-01-22 17:22:20,273 - services.service_manager - INFO - âœ… Intent classifier loaded
2026-01-22 17:22:20,276 - services.conversation_context_manager - INFO - âœ… ConversationContextManager initialized with Redis
2026-01-22 17:22:20,276 - services.service_manager - INFO - âœ… Context manager loaded
2026-01-22 17:22:20,276 - services.turkish_typo_corrector - INFO - âœ… TurkishTypoCorrector initialized
2026-01-22 17:22:20,276 - services.service_manager - INFO - âœ… Typo corrector loaded
2026-01-22 17:22:20,276 - services.service_manager - INFO - ğŸ‰ Service Manager initialized: 13/13 services active
2026-01-22 17:22:20,276 - core.startup_fixed - INFO - âœ… Service Manager initialized
2026-01-22 17:22:20,276 - core.startup_guard - INFO - âœ… multi_route marked as initialized
2026-01-22 17:22:20,276 - core.startup_fixed - INFO - ğŸ”„ Initializing Moovit-style multi-route system...
2026-01-22 17:22:20,278 - services.route_optimizer - INFO - âœ… Accessibility features available
2026-01-22 17:22:20,278 - services.route_optimizer - INFO - âœ… OpenAI available for route summaries
2026-01-22 17:22:20,278 - services.accessibility_features - INFO - âœ… Accessibility checker initialized with 59 stations
2026-01-22 17:22:20,278 - services.route_optimizer - INFO - âœ… Accessibility checker integrated with route optimizer
2026-01-22 17:22:20,278 - core.startup_fixed - INFO - âœ… Route Optimizer initialized
2026-01-22 17:22:20,279 - services.transportation_route_integration - INFO - âœ… Route optimizer imported successfully
2026-01-22 17:22:20,279 - services.transportation_route_integration - INFO - âœ… Transportation services imported successfully
2026-01-22 17:22:20,280 - services.transportation_rag_system - INFO - âœ… Transportation RAG: Redis connected for route caching
2026-01-22 17:22:20,282 - services.transportation_station_normalization - INFO - âœ… Station normalizer initialized: 264 stations, 17 lines
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO - âœ… Built station graph from canonical data: 264 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO - ğŸ“Š Station counts by line:
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   FERRY: 15 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M11: 9 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M1A: 18 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M1B: 13 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M2: 16 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M3: 19 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M4: 24 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M5: 20 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M6: 4 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M7: 17 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   M9: 2 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   MARMARAY: 43 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   T1: 31 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   T4: 22 stations
2026-01-22 17:22:20,282 - services.transportation_rag_system - INFO -   T5: 11 stations
2026-01-22 17:22:20,283 - services.transportation_rag_system - INFO - âœ… Transportation RAG initialized with complete Istanbul network
2026-01-22 17:22:20,283 - services.transportation_rag_system - INFO - âœ… Dijkstra routing enabled with realistic travel times
2026-01-22 17:22:20,283 - services.transportation_rag_system - INFO - âœ… Station/Line ID normalization enabled
2026-01-22 17:22:20,283 - services.transportation_rag_system - INFO - âœ… Route caching enabled with Redis
2026-01-22 17:22:20,283 - services.transportation_rag_system - INFO - âœ… Transportation RAG singleton initialized
2026-01-22 17:22:20,283 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:22:20,285 - services.osrm_routing_service - INFO - âœ… OSRM routing cache enabled (Redis)
2026-01-22 17:22:20,285 - services.osrm_routing_service - INFO - OSRM Routing Service initialized (server: primary, profile: foot, cache: True)
2026-01-22 17:22:20,285 - services.transportation_directions_service - INFO - âœ… OSRM service initialized successfully
2026-01-22 17:22:20,285 - services.graph_routing_engine - INFO - ğŸ—ï¸ Building Istanbul transportation graph...
2026-01-22 17:22:20,285 - services.graph_routing_engine - INFO - ğŸ”„ Adding transfer connections...
2026-01-22 17:22:20,286 - services.graph_routing_engine - INFO - âœ… Added 154 transfer connections
2026-01-22 17:22:20,286 - services.graph_routing_engine - INFO - âœ… Graph built: 208 nodes, 528 edges
2026-01-22 17:22:20,286 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine initialized successfully
2026-01-22 17:22:20,286 - services.transportation_directions_service - INFO - âœ… Transportation Directions Service initialized
2026-01-22 17:22:20,286 - services.transportation_route_integration - INFO - âœ… Transportation services initialized
2026-01-22 17:22:20,286 - services.route_optimizer - INFO - âœ… Accessibility checker integrated with route optimizer
2026-01-22 17:22:20,286 - services.route_optimizer - INFO - âœ… RouteOptimizer initialized
2026-01-22 17:22:20,286 - services.transportation_route_integration - INFO - âœ… Route optimizer initialized
2026-01-22 17:22:20,286 - services.transportation_route_integration - INFO - âœ… TransportationRouteIntegration initialized
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - âœ… Transportation Route Integration initialized
2026-01-22 17:22:20,286 - services.enhanced_map_visualization_service - INFO - âœ… Enhanced Map Visualization Service initialized with Route Integration
2026-01-22 17:22:20,286 - services.enhanced_map_visualization_service - INFO - âœ… Transportation RAG integrated
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - âœ… Enhanced Map Visualization Service initialized
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - ğŸ—ºï¸ Multi-route system ready - Moovit-level features enabled!
2026-01-22 17:22:20,286 - core.startup_guard - INFO - âœ… models marked as initialized
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - ğŸ”„ Starting background LLM initialization...
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - â­ï¸ Model preloading disabled (using RunPod LLM)
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - âœ… Dependencies ready after 0s
2026-01-22 17:22:20,286 - core.startup_fixed - INFO - ğŸ” DB initialized: True, Services initialized: True
2026-01-22 17:22:20,286 - services.llm.core - INFO - â„¹ï¸  USE_UNIFIED_LLM=true but llm_client provided, using provided client
2026-01-22 17:22:20,286 - services.llm.core - INFO - ğŸ›¡ï¸ Initializing resilience components...
2026-01-22 17:22:20,286 - services.llm.core - INFO - âœ… Resilience components initialized
2026-01-22 17:22:20,286 - services.llm.fuzzy_matcher - INFO - âœ… FuzzyMatcher initialized (threshold=85, phonetic=True)
2026-01-22 17:22:20,286 - services.llm.signals - INFO - âœ… Fuzzy matching enabled (phonetic search available)
2026-01-22 17:22:20,287 - services.model_cache - INFO - ğŸ“¦ ModelCache initialized
2026-01-22 17:22:22,996 - services.model_cache - INFO - ğŸ”„ Loading SentenceTransformer: all-MiniLM-L6-v2
2026-01-22 17:22:25,233 - services.model_cache - INFO - âœ… SentenceTransformer loaded: all-MiniLM-L6-v2
2026-01-22 17:22:25,234 - services.llm.embedding_service - INFO - âœ… Loaded embedding model: lightweight (cached)
2026-01-22 17:22:25,778 - services.llm.embedding_service - INFO - âœ… Loaded intent examples for 6 intents
2026-01-22 17:22:25,778 - services.llm.embedding_service - INFO - âœ… EmbeddingService initialized (mode: lightweight, offline: False)
2026-01-22 17:22:25,778 - services.llm.signals - INFO - âœ… Semantic embeddings enabled: online
2026-01-22 17:22:25,779 - services.llm.istanbul_knowledge - INFO - âœ… Istanbul Knowledge initialized: 13 landmarks, 10 neighborhoods
2026-01-22 17:22:25,779 - services.llm.signals - INFO - âœ… Istanbul intelligence enabled: 13 landmarks
2026-01-22 17:22:25,788 - services.transportation_intent_classifier - INFO - âœ… Hybrid Intent Classifier initialized with embeddings
2026-01-22 17:22:25,788 - services.llm.signals - INFO - âœ… Hybrid transportation intent classifier enabled
2026-01-22 17:22:25,788 - services.llm.signals - INFO - âœ… Signal Detector initialized (fuzzy=True, context=True, embeddings=True, istanbul=True, transport_classifier=True)
2026-01-22 17:22:25,788 - services.llm.context - INFO - âœ… Context Builder initialized
2026-01-22 17:22:25,788 - services.llm.context - INFO -    ğŸ“¦ Service Manager available for enhanced context building
2026-01-22 17:22:25,788 - services.llm.prompts - INFO - âœ… Prompt Builder initialized
2026-01-22 17:22:25,791 - services.llm.feedback_trainer - INFO - Loaded 58 training samples
2026-01-22 17:22:25,791 - services.llm.feedback_trainer - INFO - âœ… FeedbackTrainer initialized with 58 existing samples
2026-01-22 17:22:25,791 - services.llm.analytics - INFO - âœ… Feedback loop enabled for continuous improvement
2026-01-22 17:22:25,791 - services.llm.analytics - INFO - âœ… Analytics Manager initialized
2026-01-22 17:22:25,791 - services.llm.query_enhancement - INFO - âœ… Query Enhancer initialized
2026-01-22 17:22:25,791 - services.llm.conversation - INFO - âœ… Conversation Manager initialized
2026-01-22 17:22:25,791 - services.llm.caching - INFO - âœ… Cache Manager initialized (semantic=enabled)
2026-01-22 17:22:25,791 - services.llm.experimentation - INFO - âœ… Experimentation Manager initialized (A/B=off)
2026-01-22 17:22:25,791 - services.llm.personalization - INFO - âœ… Personalization Engine initialized
2026-01-22 17:22:25,791 - services.llm.auto_tuning - INFO - âœ… Auto-Tuner initialized
2026-01-22 17:22:25,791 - services.llm.core - INFO - âœ… All subsystems initialized (including Phase 2 features)
2026-01-22 17:22:25,791 - services.llm.core - INFO - ğŸš€ Pure LLM Core initialized successfully
2026-01-22 17:22:25,791 - services.llm.core - INFO -    ğŸ¤– LLM Service: Legacy RunPodClient
2026-01-22 17:22:25,791 - services.llm.core - INFO -    ğŸ“¦ Service Manager: 13/13 services available
2026-01-22 17:22:25,791 - core.startup_fixed - INFO - âœ… Pure LLM Core initialized (background)
2026-01-22 17:22:25,791 - services.redis_cache - WARNING - âš ï¸ Redis ping timeout (2s) - continuing without cache
2026-01-22 17:22:25,791 - core.startup_fixed - INFO - âœ… Redis cache initialized successfully
2026-01-22 17:22:33,883 - core.middleware - INFO - ğŸ’¬ CHAT: 'hi...'
2026-01-22 17:22:33,891 - services.ai_chat_route_integration - INFO - âœ… LLM Route Preference Detector available
2026-01-22 17:22:33,894 - services.intelligent_route_integration - INFO - âœ… OSRM Routing Service available
2026-01-22 17:22:33,895 - services.intelligent_route_integration - INFO - âœ… Map Visualization Engine available
2026-01-22 17:22:33,898 - root - INFO - âœ… POI Database Service integrated successfully!
2026-01-22 17:22:33,899 - ml_prediction_service - INFO - âœ… ML Prediction Cache Service integrated successfully!
2026-01-22 17:22:33,899 - ml_prediction_service - INFO - â„¹ï¸  XGBoost/LightGBM not installed - using pattern-based prediction fallback: No module named 'xgboost'
2026-01-22 17:22:33,901 - root - INFO - âœ… ML Prediction Service integrated successfully!
2026-01-22 17:22:34,686 - lightweight_neural_query_enhancement - INFO - â„¹ï¸  spaCy model not found. Install with: python -m spacy download en_core_web_sm
2026-01-22 17:22:34,686 - lightweight_neural_query_enhancement - INFO - â„¹ï¸  TextBlob not installed - using basic sentiment analysis
2026-01-22 17:22:34,687 - ml_enhanced_transportation_system - INFO - âœ… Lightweight Neural Query Enhancement integrated successfully!
2026-01-22 17:22:34,687 - ml_enhanced_transportation_system - INFO - âœ… ML Prediction Cache Service integrated successfully!
2026-01-22 17:22:34,687 - ml_enhanced_transportation_system - INFO - âœ… ML Prediction Cache Service integrated successfully!
2026-01-22 17:22:34,841 - ml_enhanced_transportation_system - INFO - â„¹ï¸  XGBoost/LightGBM not installed - using basic crowding prediction: No module named 'xgboost'
2026-01-22 17:22:34,846 - root - WARNING - Transport Graph Service not available
2026-01-22 17:22:34,847 - services.ml_prediction_service - INFO - âœ… ML Prediction Cache Service integrated successfully!
2026-01-22 17:22:34,847 - services.ml_prediction_service - INFO - â„¹ï¸  XGBoost/LightGBM not installed - using pattern-based prediction fallback: No module named 'xgboost'
2026-01-22 17:22:34,849 - root - INFO - âœ… POI-Enhanced Route Optimizer integrated successfully!
2026-01-22 17:22:35,194 - ibb_real_time_api - INFO - ğŸŒ Ä°BB Real-Time API initialized (Live APIs: True)
2026-01-22 17:22:35,194 - ibb_real_time_api - INFO - â„¹ï¸  Ä°BB API key not configured - using fallback mode with simulated data
2026-01-22 17:22:35,195 - backend.services.transportation_directions_service - INFO - âœ… Backend OSRM routing service imported successfully
2026-01-22 17:22:35,196 - backend.services.transportation_directions_service - INFO - âœ… Graph-based routing engine imported successfully
2026-01-22 17:22:35,199 - istanbul_ai.core.user_management - INFO - âœ… TTLCache available for UserManager
2026-01-22 17:22:35,210 - istanbul_ai.main_system - INFO - âœ… Hidden Gems Handler loaded successfully
2026-01-22 17:22:35,211 - istanbul_ai.main_system - INFO - âœ… Price Filter Service loaded successfully
2026-01-22 17:22:35,211 - istanbul_ai.main_system - INFO - âœ… Events Service loaded successfully
2026-01-22 17:22:35,211 - istanbul_ai.main_system - INFO - âœ… Weather Recommendations Service loaded successfully
2026-01-22 17:22:35,327 - enhanced_transportation_integration - INFO - ğŸš‡ Enhanced transportation system initialized with NEW modular architecture
2026-01-22 17:22:35,327 - istanbul_ai.main_system - INFO - âœ… Advanced transportation system loaded successfully
2026-01-22 17:22:35,328 - transportation_chat_integration - INFO - âœ… Transfer Instructions & Map Visualization loaded successfully
2026-01-22 17:22:35,328 - istanbul_ai.main_system - INFO - âœ… Transfer Instructions & Map Visualization integration loaded successfully
2026-01-22 17:22:35,366 - ml_enhanced_daily_talks_bridge.deep_learning - INFO - âœ… Deep Learning libraries loaded successfully
2026-01-22 17:22:35,369 - daily_talks_integration_wrapper - INFO - âœ… Comprehensive Daily Talks System loaded successfully
2026-01-22 17:22:35,371 - services.weather_cache_service - WARNING - âš ï¸ No OpenWeather API key found - using fallback data
2026-01-22 17:22:35,372 - services.weather_cache_service - INFO - âœ… Loaded 24 forecast entries from cache
2026-01-22 17:22:35,374 - services.advanced_daily_talk_ai - INFO - ğŸ§  Advanced Daily Talk AI System initialized - GPT-level intelligence ready!
2026-01-22 17:22:35,374 - daily_talks_integration_wrapper - WARNING - âš ï¸ Legacy daily talk system not available: cannot import name 'get_daily_greeting' from 'services.daily_talk_enhancement' (/Users/omer/Desktop/ai-stanbul/services/daily_talk_enhancement.py)
2026-01-22 17:22:35,414 - monthly_events_scheduler - INFO - ğŸ“… Monthly Events Scheduler initialized
2026-01-22 17:22:35,414 - monthly_events_scheduler - INFO - âœ… Selenium scraper available for JavaScript-rendered content
2026-01-22 17:22:35,414 - ml_enhanced_daily_talks_bridge - INFO - âœ… Ä°KSV Events System loaded successfully
2026-01-22 17:22:35,414 - ml_enhanced_daily_talks_bridge - INFO - âœ… Location Detection for Events loaded successfully
2026-01-22 17:22:35,415 - comprehensive_daily_talks_system - INFO - ğŸ‰ Comprehensive Daily Talks System initialized
2026-01-22 17:22:35,415 - daily_talks_integration_wrapper - INFO - ğŸ‰ Initializing with Comprehensive Daily Talks System
2026-01-22 17:22:35,415 - ml_enhanced_daily_talks_bridge - INFO - Using device: cpu
2026-01-22 17:22:39,918 - ml_enhanced_daily_talks_bridge - INFO - NLP components initialized successfully
2026-01-22 17:22:39,918 - ml_enhanced_daily_talks_bridge - INFO - âœ… Deep learning models initialized successfully
2026-01-22 17:22:39,918 - ml_enhanced_daily_talks_bridge - INFO - ML/DL models initialized successfully
2026-01-22 17:22:39,918 - ml_enhanced_daily_talks_bridge - INFO - ML-Enhanced Daily Talks Bridge initialized
2026-01-22 17:22:39,918 - istanbul_ai.main_system - INFO - âœ… ML-Enhanced Daily Talks Bridge loaded successfully
2026-01-22 17:22:39,918 - istanbul_ai.main_system - INFO - âœ… Production infrastructure (TTLCache) loaded successfully
2026-01-22 17:22:39,920 - istanbul_ai.main_system - INFO - âœ… Enhanced Bilingual Daily Talks System loaded successfully
2026-01-22 17:22:39,921 - istanbul_ai.main_system - INFO - âœ… Neural Query Classifier (DistilBERT) loaded successfully
2026-01-22 17:22:39,921 - services.lightweight_neural_query_enhancement - INFO - â„¹ï¸  spaCy model not found. Install with: python -m spacy download en_core_web_sm
2026-01-22 17:22:39,922 - services.lightweight_neural_query_enhancement - INFO - â„¹ï¸  TextBlob not installed - using basic sentiment analysis
2026-01-22 17:22:39,922 - istanbul_ai.main_system - INFO - âœ… Neural Query Enhancement System loaded successfully
2026-01-22 17:22:39,924 - multi_intent_query_handler - INFO - ğŸ§  Lightweight Deep Learning System available!
2026-01-22 17:22:39,927 - multi_intent_query_handler - INFO - ğŸ›ï¸ Istanbul Attractions System integrated successfully!
2026-01-22 17:22:39,927 - multi_intent_query_handler - INFO - ğŸ­ Ä°KSV Events System integrated successfully!
2026-01-22 17:22:39,928 - multi_intent_query_handler - INFO - ğŸ›ï¸ Enhanced Museum Route Planner integrated successfully!
2026-01-22 17:22:39,929 - comprehensive_ml_dl_integration - INFO - ğŸ§  Deep Learning System available for comprehensive integration!
2026-01-22 17:22:39,930 - comprehensive_ml_dl_integration - WARNING - Enhanced Transportation System not available: cannot import name 'TransportMode' from 'enhanced_transportation_system' (/Users/omer/Desktop/ai-stanbul/enhanced_transportation_system.py)
2026-01-22 17:22:39,936 - multi_intent_query_handler - INFO - ğŸš€ Comprehensive ML/DL Integration System available!
2026-01-22 17:22:39,937 - istanbul_ai.main_system - INFO - âœ… Multi-Intent Query Handler loaded successfully
2026-01-22 17:22:39,938 - istanbul_ai.main_system - INFO - âœ… Advanced Personalization System loaded successfully
2026-01-22 17:22:39,939 - istanbul_ai.main_system - INFO - âœ… Real-time Feedback Loop System loaded successfully
2026-01-22 17:22:39,940 - root - WARNING - âš ï¸ Enhanced LLM client not available: No module named 'enhanced_llm_config'
2026-01-22 17:22:39,941 - root - WARNING - âš ï¸ Enhanced LLM client not available: No module named 'enhanced_llm_config'
2026-01-22 17:22:39,942 - root - INFO - âœ… HandlerLLMMixin loaded successfully
2026-01-22 17:22:39,946 - root - WARNING - âš ï¸ Enhanced LLM client not available: No module named 'enhanced_llm_config'
2026-01-22 17:22:39,946 - istanbul_ai.main_system - INFO - âœ… ML-Enhanced Handlers loaded successfully
2026-01-22 17:22:39,949 - istanbul_ai.main_system - WARNING - âš ï¸ A/B Testing Framework not available: cannot import name 'ABAnalytics' from 'istanbul_ai.testing.ab_analytics' (/Users/omer/Desktop/ai-stanbul/istanbul_ai/testing/ab_analytics.py)
2026-01-22 17:22:39,949 - root - INFO - âœ… Intelligent Location Detector integrated successfully!
2026-01-22 17:22:39,951 - services.intelligent_route_integration - WARNING - âš ï¸ Enhanced GPS Route Planner not available: cannot import name 'RoutePreference' from 'enhanced_gps_route_planner' (/Users/omer/Desktop/ai-stanbul/enhanced_gps_route_planner.py)
2026-01-22 17:22:39,951 - services.intelligent_route_integration - WARNING - âš ï¸ ML-Enhanced Transportation System not available: cannot import name 'create_ml_enhanced_transportation_system' from 'ml_enhanced_transportation_system' (/Users/omer/Desktop/ai-stanbul/ml_enhanced_transportation_system.py)
2026-01-22 17:22:39,951 - services.ai_chat_route_integration - INFO - âœ… Intelligent Route Integration available
2026-01-22 17:22:39,952 - services.multi_stop_route_planner - INFO - âœ… Routing infrastructure available for multi-stop planning
2026-01-22 17:22:39,953 - services.ai_chat_route_integration - INFO - âœ… Multi-stop route planner available
2026-01-22 17:22:39,955 - services.ai_chat_route_integration - INFO - âœ… GPS turn-by-turn navigation available
2026-01-22 17:22:39,959 - services.ai_chat_route_integration - INFO - âœ… Istanbul Geocoder available for location fallback
2026-01-22 17:22:39,959 - services.ai_chat_route_integration - INFO - âœ… Using Transportation RAG System for route planning
2026-01-22 17:22:39,959 - services.ai_chat_route_integration - INFO - âœ… AI Chat Route Handler initialized (RAG-powered)
2026-01-22 17:22:39,960 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:22:39,961 - services.osrm_routing_service - INFO - âœ… OSRM routing cache enabled (Redis)
2026-01-22 17:22:39,961 - services.osrm_routing_service - INFO - OSRM Routing Service initialized (server: primary, profile: foot, cache: True)
2026-01-22 17:22:39,961 - services.transportation_directions_service - INFO - âœ… OSRM service initialized successfully
2026-01-22 17:22:39,961 - services.graph_routing_engine - INFO - ğŸ—ï¸ Building Istanbul transportation graph...
2026-01-22 17:22:39,962 - services.graph_routing_engine - INFO - ğŸ”„ Adding transfer connections...
2026-01-22 17:22:39,962 - services.graph_routing_engine - INFO - âœ… Added 154 transfer connections
2026-01-22 17:22:39,962 - services.graph_routing_engine - INFO - âœ… Graph built: 208 nodes, 528 edges
2026-01-22 17:22:39,962 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine initialized successfully
2026-01-22 17:22:39,962 - services.transportation_directions_service - INFO - âœ… Transportation Directions Service initialized
2026-01-22 17:22:39,962 - services.route_optimizer - INFO - âœ… Accessibility checker integrated with route optimizer
2026-01-22 17:22:39,962 - services.multi_stop_route_planner - INFO - âœ… Multi-stop route planner initialized
2026-01-22 17:22:39,962 - services.ai_chat_route_integration - INFO - âœ… Multi-stop planner initialized
2026-01-22 17:22:39,962 - services.istanbul_geocoder - INFO - âœ… Istanbul Geocoder initialized (80 landmarks)
2026-01-22 17:22:39,962 - services.ai_chat_route_integration - INFO - âœ… Istanbul Geocoder initialized with external fallback enabled
2026-01-22 17:22:39,962 - api.chat - INFO - ğŸ” Chat endpoint called - pure_llm_core exists: True
2026-01-22 17:22:39,962 - api.chat - INFO - ğŸ” LLM client exists: True
2026-01-22 17:22:39,963 - api.chat - INFO - ğŸ’¬ Phase 4.2: Conversation Context Resolution for session: session_5752751799790088118
2026-01-22 17:22:39,963 - services.llm.conversation_context_manager - INFO - âœ… LLM Conversation Context Manager initialized
2026-01-22 17:22:39,963 - services.llm.conversation_context_manager - INFO - ğŸ“ Created new conversation session: session_5752751799790088118
2026-01-22 17:22:39,963 - services.llm.conversation_context_manager - INFO - âš ï¸  Fallback context resolution for 'hi...': references=[]
2026-01-22 17:22:39,963 - api.chat - INFO - âœ… Context Resolution complete:
   - Has References: False
   - Confidence: 0.60
   - Resolved Refs: []
   - Needs Clarification: False
   - Source: fallback
2026-01-22 17:22:39,963 - api.chat - INFO -    Original: 'hi'
2026-01-22 17:22:39,963 - api.chat - INFO -    Resolved: 'hi'
2026-01-22 17:22:39,963 - api.chat - INFO - âš¡ Skipping multi-intent detection - using Pure LLM for fast response
2026-01-22 17:22:39,964 - api.chat - INFO - âš¡ Skipping intent classification - Pure LLM handles this naturally
2026-01-22 17:22:39,965 - services.unified_intent_router - INFO - âœ… Unified Intent Router initialized
2026-01-22 17:22:39,965 - services.unified_intent_router - INFO - ğŸ¯ Intent detected: daily_talks (confidence: 0.30, language: en, keywords: ['hi'])
2026-01-22 17:22:39,965 - api.chat - INFO - âœ… Unified Router handled: daily_talks (fast path)
2026-01-22 17:22:39,965 - services.llm.response_enhancer - INFO - âœ… LLM Response Enhancer initialized
2026-01-22 17:22:39,965 - api.chat - INFO - âœ… Response Enhancer initialized
2026-01-22 17:22:39,966 - services.llm.response_enhancer - INFO - âœ… Enhanced response (type=daily_talks, time=0ms)
2026-01-22 17:22:39,966 - core.middleware - WARNING - âš ï¸ SLOW CHAT: 6083ms - 'hi...'
âš ï¸ Warning: Could not import from models.py: partially initialized module 'models' has no attribute 'User' (most likely due to a circular import)
âœ… Real-time learning models imported successfully
âœ… GPS Navigation models imported successfully
âœ… Advanced AI features loaded successfully
âœ… Loaded 300 restaurants from database
âœ… Loaded 18 hidden gems from database
âœ… Loaded 38 manually curated Ä°KSV events
âœ… Loaded 7 auto-scraped Ä°KSV events
âœ… Enhanced Transportation Service integrated with knowledge database
âœ… Istanbul Knowledge Database loaded
âš ï¸ Route Maker Service not available for GPS validation: No module named 'geopy'
âœ… Hidden Gems Database Loaded: 29 gems across 6 neighborhoods
INFO:     127.0.0.1:59071 - "POST /api/chat HTTP/1.1" 200 OK
2026-01-22 17:22:52,278 - core.middleware - INFO - ğŸ’¬ CHAT: 'What is the best food to try in Istanbul?...'
2026-01-22 17:22:52,279 - api.chat - INFO - ğŸ” Chat endpoint called - pure_llm_core exists: True
2026-01-22 17:22:52,279 - api.chat - INFO - ğŸ” LLM client exists: True
2026-01-22 17:22:52,279 - api.chat - INFO - ğŸ’¬ Phase 4.2: Conversation Context Resolution for session: session_5731840139047215546
2026-01-22 17:22:52,279 - services.llm.conversation_context_manager - INFO - ğŸ“ Created new conversation session: session_5731840139047215546
2026-01-22 17:22:52,279 - services.llm.conversation_context_manager - INFO - âš ï¸  Fallback context resolution for 'What is the best food to try in Istanbul?...': references=[]
2026-01-22 17:22:52,279 - api.chat - INFO - âœ… Context Resolution complete:
   - Has References: False
   - Confidence: 0.60
   - Resolved Refs: []
   - Needs Clarification: False
   - Source: fallback
2026-01-22 17:22:52,279 - api.chat - INFO -    Original: 'What is the best food to try in Istanbul?'
2026-01-22 17:22:52,279 - api.chat - INFO -    Resolved: 'What is the best food to try in Istanbul?'
2026-01-22 17:22:52,279 - api.chat - INFO - âš¡ Skipping multi-intent detection - using Pure LLM for fast response
2026-01-22 17:22:52,279 - api.chat - INFO - âš¡ Skipping intent classification - Pure LLM handles this naturally
2026-01-22 17:22:52,279 - services.unified_intent_router - INFO - ğŸ¯ Intent detected: restaurant (confidence: 0.30, language: en, keywords: ['food'])
2026-01-22 17:22:52,280 - services.unified_intent_router - WARNING - Restaurant handler not available
2026-01-22 17:22:52,280 - api.chat - WARNING - Hidden gems GPS check failed: No module named 'services.hidden_gems_gps'
2026-01-22 17:22:52,280 - api.chat - INFO - â„¹ï¸ Skipping legacy route handler - unified router handles this
2026-01-22 17:22:52,281 - api.chat - WARNING - âš ï¸  RAG Service not available: No module named 'chromadb'
2026-01-22 17:22:52,281 - api.chat - INFO - ğŸš€ Processing query through Pure LLM (language: en)
2026-01-22 17:22:52,281 - services.llm.core - INFO - ğŸ” Processing query: What is the best food to try in Istanbul?...
2026-01-22 17:22:52,282 - services.llm.core - INFO - âœ¨ Query enhanced: {'spell_corrected': False, 'rewritten': True, 'validation': {'valid': True, 'quality_score': 1.0, 'needs_clarification': False, 'clarification': None, 'complexity': 'medium', 'issues': []}, 'original_query': None}
2026-01-22 17:22:52,282 - services.runpod_llm_client - INFO - â„¹ï¸ HTTP/2 not available (h2 package not installed), using HTTP/1.1
2026-01-22 17:22:52,345 - services.runpod_llm_client - INFO - ğŸ”Œ Created shared HTTP client with connection pool (HTTP/2: False)
2026-01-22 17:22:52,345 - services.runpod_llm_client - INFO - [3286cf45] ğŸ”„ Calling LLM at: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1/chat/completions
INFO:     127.0.0.1:59086 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59086 - "GET /api/health HTTP/1.1" 200 OK
2026-01-22 17:22:53,748 - services.runpod_llm_client - INFO - [3286cf45] âœ… LLM generated 111 chars
2026-01-22 17:22:53,748 - services.llm.core - INFO - âœ¨ Query rewritten: 'What is the best food to try in Istanbul?' â†’ 'Query: "What is the best food to try in Istanbul'
2026-01-22 17:22:53,748 - services.llm.core - INFO - ğŸ”„ Using rewritten query for signal detection: Query: "What is the best food to try in Istanbul
2026-01-22 17:22:54,607 - services.transportation_intent_classifier - INFO - ğŸ¯ Intent classification: confidence=0.000, regex=False, semantic=0.598, locations=1, gps=False
2026-01-22 17:22:54,611 - services.llm.core - INFO - ğŸ¯ Signals detected: needs_restaurant
2026-01-22 17:22:54,612 - services.llm.context - INFO - âœ… High signal confidence (0.90), providing FOCUSED context
2026-01-22 17:22:54,799 - services.llm.context - ERROR - Failed to get restaurants: object CursorResult can't be used in 'await' expression
2026-01-22 17:22:54,800 - services.location_based_context_enhancer - INFO - âœ… Hidden Gems Service loaded
2026-01-22 17:22:54,801 - services.events_service - INFO - âœ… Loaded 45 Ä°KSV events from database
2026-01-22 17:22:54,801 - services.location_based_context_enhancer - INFO - âœ… Events Service loaded
2026-01-22 17:22:54,803 - services.location_based_context_enhancer - INFO - âœ… Restaurant Service loaded
2026-01-22 17:22:54,804 - services.location_based_context_enhancer - INFO - âœ… Attractions Service loaded
2026-01-22 17:22:54,804 - services.location_based_context_enhancer - INFO - ğŸ’ Added 3 hidden gems to context
2026-01-22 17:22:54,804 - services.llm.context - WARNING - Location-based context enhancement failed: 'ContextBuilder' object has no attribute '_merge_location_enriched_context'
2026-01-22 17:22:54,804 - services.llm.core - INFO - ğŸ“š Context built: DB=0 chars, RAG=0 chars, Services=0 items
2026-01-22 17:22:54,804 - services.llm.core - INFO - ğŸ“ Prompt built: 2801 chars, signal confidence: 0.90
2026-01-22 17:22:54,804 - services.llm.core - INFO - ğŸ“ Calling LLM...
2026-01-22 17:22:54,804 - services.llm.core - INFO - ğŸ“ Prompt length: 2801 chars
2026-01-22 17:22:54,804 - services.llm.core - INFO - ğŸ”š Prompt ending (last 300 chars): ... Describe famous places with practical information
- Include opening hours and ticket prices if available in context
- Respond in the user's language

Remember: ALWAYS match the user's language. This is your most important rule.

---

User: Query: "What is the best food to try in Istanbul

Response:
2026-01-22 17:22:54,804 - services.runpod_llm_client - INFO - [71ce4384] ğŸ”„ Calling LLM at: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1/chat/completions
2026-01-22 17:22:59,712 - services.runpod_llm_client - INFO - [71ce4384] âœ… LLM generated 638 chars
2026-01-22 17:22:59,712 - services.llm.core - INFO - ğŸ“¥ LLM returned response with keys: ['generated_text', 'raw', 'request_id', 'cached', 'latency_ms']
2026-01-22 17:22:59,712 - services.llm.core - INFO - ğŸ” Response data type: <class 'dict'>, keys: ['generated_text', 'raw', 'request_id', 'cached', 'latency_ms']
2026-01-22 17:22:59,712 - services.llm.core - INFO - ğŸ” Response text length: 638, type: <class 'str'>
2026-01-22 17:22:59,712 - services.llm.core - INFO - ğŸ” RAW LLM RESPONSE (FULL): "**Ä°stanbullu** yemekler, Ã§eÅŸitlilik ve lezzet aÃ§Ä±sÄ±ndan zengin! \n\n* **Doner Kebab**: Istanbul'un meÅŸhur kebaplarÄ±ndan biridir. Sade veya zengin lezzet seÃ§enekleri mevcuttur.\n* **Lahmacun**: YumurtalÄ± veya yumurtasÄ±z, soslu veya sossuz; her Ã§eÅŸit lehmacun, Ä°stanbul'da tadÄ±nÄ± Ã§Ä±karabileceÄŸiniz lezzetli bir yemek.\n* **Baklava**: FÄ±stÄ±k ezmesi ve ÅŸekerle kaplÄ±, kat kat yapÄ±lan bir tatlÄ±.\n* **Manti**: Ä°steÄŸe gÃ¶re soslu veya sossuz, bu lezzetli yemek, Ä°stanbul'un sokaklarÄ±nda Ã§ok popÃ¼ler.\n\nÄ°stanbullu yemekler, her bÃ¼tÃ§eye uygun ve lezzetli seÃ§enekleri sunuyor. Bazen sokakta, bazen restoranda tatmak istediÄŸiniz lezzetleri bulabilirsiniz."
2026-01-22 17:22:59,712 - services.llm.core - INFO - ğŸ§¹ Applying training data leakage filter to 638 chars...
2026-01-22 17:22:59,713 - services.llm.core - INFO - âœ… After filter: 638 chars
2026-01-22 17:22:59,713 - services.llm.core - INFO - âœ… After formatting cleanup: 638 chars
2026-01-22 17:22:59,714 - services.llm.core - INFO - ğŸ” FINAL CLEANED RESPONSE: **Ä°stanbullu** yemekler, Ã§eÅŸitlilik ve lezzet aÃ§Ä±sÄ±ndan zengin! 

* **Doner Kebab**: Istanbul'un meÅŸhur kebaplarÄ±ndan biridir. Sade veya zengin lezzet seÃ§enekleri mevcuttur.
* **Lahmacun**: YumurtalÄ± veya yumurtasÄ±z, soslu veya sossuz; her Ã§eÅŸit lehmacun, Ä°stanbul'da tadÄ±nÄ± Ã§Ä±karabileceÄŸiniz lezzetli bir yemek.
* **Baklava**: FÄ±stÄ±k ezmesi ve ÅŸekerle kaplÄ±, kat kat yapÄ±lan bir tatlÄ±.
* **Manti**: Ä°steÄŸe gÃ¶re soslu veya sossuz, bu lezzetli yemek, Ä°stanbul'un sokaklarÄ±nda Ã§ok popÃ¼ler.

Ä°stanbullu ...
2026-01-22 17:22:59,714 - services.llm.core - INFO - âœ… LLM generated response in 4.91s (length: 638 chars)
2026-01-22 17:22:59,714 - services.llm.core - INFO - ğŸ”§ Fixed truncated response: 638 â†’ 638 chars
2026-01-22 17:22:59,714 - services.llm.core - WARNING - âš ï¸ Response was truncated and cleaned up
2026-01-22 17:22:59,714 - services.llm.core - WARNING - âš ï¸ Low factual grounding (DB: 0, RAG: 0 chars)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… Metrics Aggregator initialized (window: 60s)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… Metrics Aggregator initialized (window: 300s)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… Metrics Aggregator initialized (window: 3600s)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… Metrics Aggregator initialized (window: 86400s)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… WebhookAlerter initialized (enabled=True)
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO - âœ… Production Monitor initialized
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO -    Log directory: logs/metrics
2026-01-22 17:22:59,714 - services.llm.monitoring - INFO -    Alert thresholds: {'fallback_rate': 0.1, 'avg_response_time': 2.0, 'signal_llm_agreement': 0.7, 'signal_confidence': 0.6, 'error_rate': 0.05, 'hallucination_score': 0.3}
2026-01-22 17:22:59,714 - services.llm.core - WARNING - âš ï¸ Entity validation score: 0.40, issues: 4
2026-01-22 17:22:59,714 - services.llm.core - WARNING -    - Potential hallucinated attractions: ['Lahmacun', 'Doner Kebab', 'Manti', 'Baklava']
2026-01-22 17:22:59,714 - services.llm.analytics - ERROR - âŒ Error tracked: validation_failure - entity_hallucination: {'restaurants': [], 'attractions': ['Lahmacun', 'Doner Kebab', 'Manti', 'Bakla
2026-01-22 17:22:59,714 - services.llm.core - INFO - ğŸ—ºï¸ Checking if map_data available from context...
2026-01-22 17:22:59,715 - services.llm.core - INFO - âœ… Query processed in 7.43s
2026-01-22 17:22:59,715 - api.chat - INFO - ğŸ” Checking transport_rag.last_route: False
2026-01-22 17:22:59,715 - services.transportation_rag_system - WARNING - No last_route available for map data
2026-01-22 17:22:59,715 - api.chat - WARNING - âš ï¸  No last_route available for enrichment
2026-01-22 17:22:59,715 - api.chat - INFO - Pure LLM response generated in 7.43s (RAG: âœ—)
2026-01-22 17:22:59,715 - api.chat - INFO - ğŸ” POST-LLM Check: route_data_from_transport is None
2026-01-22 17:22:59,715 - api.chat - INFO - ğŸ”¥ POST-LLM: Attempting to extract route data...
2026-01-22 17:22:59,715 - api.chat - INFO - ğŸ” POST-LLM: transport_rag exists: True
2026-01-22 17:22:59,715 - api.chat - INFO - ğŸ” POST-LLM: last_route exists: False
2026-01-22 17:22:59,715 - api.chat - WARNING - âš ï¸ POST-LLM: last_route is None - transportation RAG may not have been called
2026-01-22 17:22:59,717 - services.llm_route_extractor - INFO - âœ… LLM Route Extractor initialized
2026-01-22 17:22:59,717 - services.llm_route_extractor - INFO - ğŸ” Extracting route from LLM response...
2026-01-22 17:22:59,717 - services.llm_route_extractor - INFO -   â†’ Not a transportation query
2026-01-22 17:22:59,717 - api.chat - INFO -    LLM Route Extractor: No route data could be extracted
2026-01-22 17:22:59,718 - services.llm.response_enhancer - INFO - âœ… Enhanced response (type=general, time=0ms)
2026-01-22 17:22:59,719 - utils.response_sanitizer - INFO - ğŸŒ Language consistency enforced: en (710 â†’ 709 chars)
2026-01-22 17:22:59,719 - api.chat - INFO - ğŸ§¹ Response sanitized - removed 27 characters of artifacts
2026-01-22 17:22:59,720 - services.llm.conversation_context_manager - INFO - ğŸ“ Recorded conversation turn for session session_5731840139047215546
2026-01-22 17:22:59,720 - services.llm.suggestion_analyzer - INFO - SuggestionAnalyzer initialized (LLM: False)
2026-01-22 17:22:59,720 - services.llm.suggestion_generator - INFO - SuggestionGenerator initialized (LLM: False)
2026-01-22 17:22:59,720 - services.llm.suggestion_presenter - INFO - SuggestionPresenter initialized
2026-01-22 17:22:59,720 - api.chat - INFO - âœ… Phase 4.4 Proactive Suggestions initialized (heuristics-only mode)
2026-01-22 17:22:59,720 - services.llm.suggestion_analyzer - INFO - Context analyzed: should_suggest=True, confidence=0.60 (0ms)
2026-01-22 17:22:59,720 - api.chat - INFO - ğŸ’¡ Generating proactive suggestions (confidence: 0.60)
2026-01-22 17:22:59,720 - services.llm.suggestion_generator - INFO - Using template-based suggestions only (LLM disabled)
2026-01-22 17:22:59,720 - services.llm.suggestion_generator - INFO - Generated 5 suggestions (0ms)
2026-01-22 17:22:59,720 - api.chat - INFO - âœ… Generated 5 suggestions (method: template, time: 0ms)
2026-01-22 17:22:59,720 - api.chat - INFO - âœ¨ Added 5 proactive suggestions
2026-01-22 17:22:59,723 - services.data_collection - INFO - Logged interaction 11eacb189756c143 for training data
2026-01-22 17:22:59,723 - api.chat - WARNING - Failed to extract UnifiedLLMService metadata: 'Depends' object has no attribute 'circuit_breaker_open'
2026-01-22 17:22:59,724 - core.middleware - WARNING - âš ï¸ SLOW CHAT: 7446ms - 'What is the best food to try in Istanbul?...'
âœ… Loaded 18 hidden gems from database
âœ… Loaded 38 manually curated Ä°KSV events
âœ… Loaded 7 auto-scraped Ä°KSV events
âœ… Loaded 300 restaurants from database
INFO:     127.0.0.1:59083 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:59102 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59102 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59131 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59131 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59159 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59159 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59170 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59170 - "GET /api/health HTTP/1.1" 200 OK
2026-01-22 17:27:16,400 - integrated_cache_system - INFO - ğŸ’¾ Cache hit rate: 0.0% (warming up)
2026-01-22 17:27:16,401 - integrated_cache_system - INFO - ğŸ“Š Cache metrics: 0.0% hit rate, 0ms avg response, $0.00 saved
INFO:     127.0.0.1:59176 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59176 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59182 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59182 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59198 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59198 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59204 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:59204 - "GET /api/health HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'services/llm/prompts.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2026-01-22 17:31:39,925 - core.startup_fixed - INFO - âœ… Database session closed
2026-01-22 17:31:39,925 - core.startup_fixed - INFO - âœ… Redis cache shutdown complete
2026-01-22 17:31:39,925 - main_modular - INFO - ğŸ‘‹ AI Istanbul Backend shut down complete
INFO:     Application shutdown complete.
INFO:     Finished server process [300]
2026-01-22 17:31:40,457 - database - INFO - âœ… Using centralized database configuration
2026-01-22 17:31:40,457 - config.database_config - INFO - ============================================================
2026-01-22 17:31:40,457 - config.database_config - INFO - DATABASE CONFIGURATION
2026-01-22 17:31:40,457 - config.database_config - INFO - ============================================================
2026-01-22 17:31:40,457 - config.database_config - INFO - Database Type: POSTGRESQL
2026-01-22 17:31:40,457 - config.database_config - INFO - Host: localhost
2026-01-22 17:31:40,457 - config.database_config - INFO - Port: 5433
2026-01-22 17:31:40,457 - config.database_config - INFO - Database: ai_istanbul
2026-01-22 17:31:40,457 - config.database_config - INFO - Username: postgres
2026-01-22 17:31:40,457 - config.database_config - INFO - Render PostgreSQL: No
2026-01-22 17:31:40,457 - config.database_config - INFO - SSL Enabled: No
2026-01-22 17:31:40,457 - config.database_config - INFO - ============================================================
2026-01-22 17:31:40,485 - database - INFO - ï¿½ PostgreSQL engine created with connection pooling
2026-01-22 17:31:40,485 - database - INFO - ============================================================
2026-01-22 17:31:40,485 - database - INFO - ğŸ“Š DATABASE BACKEND INFORMATION
2026-01-22 17:31:40,485 - database - INFO -    Type: postgresql
2026-01-22 17:31:40,485 - database - INFO -    Driver: psycopg2
2026-01-22 17:31:40,485 - database - INFO -    Database: ai_istanbul
2026-01-22 17:31:40,485 - database - INFO -    Host: localhost
2026-01-22 17:31:40,485 - database - INFO -    Port: 5433
2026-01-22 17:31:40,485 - database - INFO -    Pool: QueuePool
2026-01-22 17:31:40,485 - database - INFO - ============================================================
2026-01-22 17:31:41,289 - services.llm.context - INFO - âœ… Industry-level Transportation RAG system available
2026-01-22 17:31:41,291 - services.llm.context - INFO - âœ… Istanbul Knowledge RAG system available
2026-01-22 17:31:41,623 - api.admin.routes - INFO - âœ… Admin routes initialized
2026-01-22 17:31:41,627 - services.smart_feedback_processor - INFO - ğŸ“ Feedback data directory: /Users/omer/Desktop/ai-stanbul/backend/training_data
2026-01-22 17:31:41,754 - ttl_fine_tuning - INFO - ğŸ”§ TTL Optimizer initialized with dynamic fine-tuning
2026-01-22 17:31:41,754 - google_api_integration - INFO - âœ… TTL fine-tuning system loaded
2026-01-22 17:31:41,755 - core.startup_guard - INFO - âœ… Redis readiness check: CONNECTED
2026-01-22 17:31:41,755 - google_api_integration - INFO - âœ… Time-aware cache using centralized Redis client
2026-01-22 17:31:41,756 - integrated_cache_system - INFO - âœ… Production cache monitor using centralized Redis client
2026-01-22 17:31:41,757 - integrated_cache_system - INFO - ğŸ”„ Production cache monitoring started
2026-01-22 17:31:41,757 - integrated_cache_system - INFO - ğŸ’¾ Cache hit rate: 0.0% (warming up)
2026-01-22 17:31:41,757 - integrated_cache_system - INFO - ğŸ“Š Cache metrics: 0.0% hit rate, 0ms avg response, $0.00 saved
2026-01-22 17:31:41,757 - integrated_cache_system - INFO - ğŸ”¥ Cache warming service started
2026-01-22 17:31:41,757 - integrated_cache_system - INFO - ğŸš€ Integrated Cache System initialized successfully
2026-01-22 17:31:41,760 - integrated_cache_system - ERROR - âŒ Error warming query 'best restaurants in Sultanahmet': Google API key not configured
2026-01-22 17:31:41,761 - integrated_cache_system - ERROR - âŒ Error warming query 'seafood restaurants near Bosphorus': Google API key not configured
2026-01-22 17:31:41,761 - integrated_cache_system - ERROR - âŒ Error warming query 'rooftop restaurants with view': Google API key not configured
2026-01-22 17:31:41,762 - integrated_cache_system - ERROR - âŒ Error warming query 'traditional Turkish restaurants': Google API key not configured
2026-01-22 17:31:41,762 - integrated_cache_system - ERROR - âŒ Error warming query 'Turkish breakfast places in BeyoÄŸlu': Google API key not configured
2026-01-22 17:31:41,762 - integrated_cache_system - ERROR - âŒ Error warming query 'restaurants with live music': Google API key not configured
2026-01-22 17:31:41,762 - integrated_cache_system - ERROR - âŒ Error warming query 'vegetarian restaurants in Karakoy': Google API key not configured
2026-01-22 17:31:41,762 - integrated_cache_system - ERROR - âŒ Error warming query 'cheap eats in Kadikoy': Google API key not configured
2026-01-22 17:31:41,763 - integrated_cache_system - ERROR - âŒ Error warming query 'halal restaurants near Hagia Sophia': Google API key not configured
2026-01-22 17:31:41,764 - backend.database - INFO - âœ… Using centralized database configuration
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'best kebab places in Istanbul': Google API key not configured
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'fine dining Istanbul': Google API key not configured
2026-01-22 17:31:41,764 - config.database_config - INFO - ============================================================
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'romantic dinner places Istanbul': Google API key not configured
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'family friendly restaurants': Google API key not configured
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'restaurants open late night': Google API key not configured
2026-01-22 17:31:41,764 - integrated_cache_system - ERROR - âŒ Error warming query 'Turkish street food': Google API key not configured
2026-01-22 17:31:41,764 - config.database_config - INFO - DATABASE CONFIGURATION
2026-01-22 17:31:41,764 - config.database_config - INFO - ============================================================
2026-01-22 17:31:41,765 - config.database_config - INFO - Database Type: POSTGRESQL
2026-01-22 17:31:41,765 - config.database_config - INFO - Host: localhost
2026-01-22 17:31:41,765 - config.database_config - INFO - Port: 5433
2026-01-22 17:31:41,765 - config.database_config - INFO - Database: ai_istanbul
2026-01-22 17:31:41,765 - config.database_config - INFO - Username: postgres
2026-01-22 17:31:41,765 - integrated_cache_system - INFO - ğŸ”¥ Cache warming completed: 0/15 queries warmed
2026-01-22 17:31:41,765 - config.database_config - INFO - Render PostgreSQL: No
2026-01-22 17:31:41,765 - config.database_config - INFO - SSL Enabled: No
2026-01-22 17:31:41,765 - config.database_config - INFO - ============================================================
2026-01-22 17:31:41,765 - backend.database - INFO - ï¿½ PostgreSQL engine created with connection pooling
2026-01-22 17:31:41,765 - backend.database - INFO - ============================================================
2026-01-22 17:31:41,765 - backend.database - INFO - ğŸ“Š DATABASE BACKEND INFORMATION
2026-01-22 17:31:41,765 - backend.database - INFO -    Type: postgresql
2026-01-22 17:31:41,765 - backend.database - INFO -    Driver: psycopg2
2026-01-22 17:31:41,765 - backend.database - INFO -    Database: ai_istanbul
2026-01-22 17:31:41,765 - backend.database - INFO -    Host: localhost
2026-01-22 17:31:41,765 - backend.database - INFO -    Port: 5433
2026-01-22 17:31:41,765 - backend.database - INFO -    Pool: QueuePool
2026-01-22 17:31:41,765 - backend.database - INFO - ============================================================
2026-01-22 17:31:42,018 - api_clients.google_analytics_api - WARNING - Google Analytics Data API not available. Install with: pip install google-analytics-data
2026-01-22 17:31:42,019 - api_clients.enhanced_google_places - WARNING - Google Places API: Using fallback mode with enhanced mock data.
2026-01-22 17:31:42,586 - routes.blog - INFO - Blog router initialized successfully
2026-01-22 17:31:42,587 - core.middleware - INFO - âœ… CORS middleware configured
2026-01-22 17:31:42,587 - core.security - INFO - âœ… Security middleware configured
2026-01-22 17:31:42,587 - core.errors - INFO - âœ… Standardized error handlers configured
2026-01-22 17:31:42,587 - core.middleware - INFO - âœ… All middleware configured
2026-01-22 17:31:42,587 - main_modular - INFO - âœ… Static files mounted at /static -> /Users/omer/Desktop/ai-stanbul/backend/static
2026-01-22 17:31:42,603 - main_modular - INFO - âœ… Streaming API registered at /api/stream
2026-01-22 17:31:42,604 - main_modular - INFO - âœ… Feedback API registered at /api/feedback
2026-01-22 17:31:42,607 - main_modular - INFO - âœ… Direct Routing API registered at /api/routes
2026-01-22 17:31:42,607 - main_modular - INFO - ğŸ“‹ Admin routes router has 10 routes
2026-01-22 17:31:42,610 - main_modular - INFO - âœ… Admin routes registered at /api/admin
2026-01-22 17:31:42,614 - main_modular - INFO - âœ… Blog API registered at /api/blog
2026-01-22 17:31:42,614 - main_modular - INFO - âœ… Cache monitoring routes registered at /api/cache
2026-01-22 17:31:42,617 - main_modular - INFO - âœ… Intent feedback routes registered at /api/feedback
2026-01-22 17:31:42,666 - main_modular - INFO - âœ… Legacy routes registered
INFO:     Started server process [1280]
INFO:     Waiting for application startup.
2026-01-22 17:31:42,666 - core.startup_guard - INFO - âœ… lifespan_startup marked as initialized
2026-01-22 17:31:42,666 - main_modular - INFO - ğŸš€ Starting application (non-blocking startup)
2026-01-22 17:31:42,666 - main_modular - INFO - ğŸ“¡ Redis status: CONNECTED
2026-01-22 17:31:42,666 - main_modular - INFO - âœ… Application ready to accept connections (background init in progress)
2026-01-22 17:31:42,666 - core.startup_guard - INFO - âœ… background_init marked as initialized
2026-01-22 17:31:42,666 - main_modular - INFO - ğŸ”„ Starting background initialization...
2026-01-22 17:31:42,666 - core.startup_guard - INFO - âœ… startup_manager marked as initialized
2026-01-22 17:31:42,666 - core.startup_fixed - INFO - ï¿½ğŸš€ Starting ULTRA-FAST initialization...
2026-01-22 17:31:42,666 - core.startup_fixed - INFO - âœ… App ready to serve traffic - components initializing in background!
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO - ğŸš€ LLM Client initialized
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    Type: openai-compatible
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    URL: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    API Key: None
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    Timeout: 60.0s
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    Max Tokens: 768
2026-01-22 17:31:42,672 - services.runpod_llm_client - INFO -    Connection Pool: 10 max, 5 keepalive
2026-01-22 17:31:42,672 - services.llm.prompts - INFO - âœ… Prompt Builder initialized
2026-01-22 17:31:42,672 - unified_system.services.unified_llm_service - INFO - âœ… Unified LLM Service - components loaded
2026-01-22 17:31:42,672 - unified_system.services.unified_llm_service - INFO - âœ… Unified LLM Service initialized (ENABLED)
2026-01-22 17:31:42,672 - unified_system.services.unified_llm_service - INFO -    Cache: âœ…
2026-01-22 17:31:42,672 - unified_system.services.unified_llm_service - INFO -    Circuit Breaker: âœ…
2026-01-22 17:31:42,672 - main_modular - INFO - âœ… UnifiedLLMService initialized and ready for API layer
2026-01-22 17:31:42,672 - main_modular - INFO - ğŸ“¡ RunPod LLM endpoint: https://p9lf44wbmqzs5l-8000.proxy.runpod.net/v1
2026-01-22 17:31:42,672 - main_modular - INFO - ğŸ¤– Model: /workspace/models/llama-3.1-8b-fp16
2026-01-22 17:31:42,672 - main_modular - INFO - ğŸ’¾ Cache: enabled (0/1000 entries)
2026-01-22 17:31:42,672 - main_modular - INFO - ğŸ›¡ï¸  Circuit breaker: enabled (threshold=5)
2026-01-22 17:31:42,672 - services.llm.ab_testing - INFO - âœ… ExperimentManager initialized
2026-01-22 17:31:42,672 - api.admin.experiments - INFO - âœ… Experiment Manager initialized
2026-01-22 17:31:42,672 - services.llm.feature_flags - INFO - âœ… FeatureFlagManager initialized
2026-01-22 17:31:42,672 - api.admin.experiments - INFO - âœ… Feature Flag Manager initialized
2026-01-22 17:31:42,672 - main_modular - INFO - âœ… Admin experiment managers initialized
2026-01-22 17:31:42,672 - main_modular - INFO - âœ… Background initialization complete!
INFO:     Application startup complete.
2026-01-22 17:31:42,672 - core.startup_guard - INFO - âœ… database marked as initialized
2026-01-22 17:31:42,672 - core.startup_fixed - INFO - ğŸ”„ Registering database models...
2026-01-22 17:31:42,672 - database - INFO - âœ… Registered 24 database models
2026-01-22 17:31:42,672 - core.startup_fixed - INFO - ğŸ”„ Creating database tables if needed...
2026-01-22 17:31:45,243 - core.startup_fixed - INFO - âœ… Database tables ready
2026-01-22 17:31:45,243 - core.startup_fixed - INFO - âœ… Database connection established
2026-01-22 17:31:45,243 - core.startup_guard - INFO - âœ… redis marked as initialized
2026-01-22 17:31:45,244 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:31:45,244 - core.startup_guard - INFO - âœ… services marked as initialized
2026-01-22 17:31:45,245 - services.service_manager - INFO - ğŸ”§ Initializing Service Manager...
2026-01-22 17:31:45,245 - services.service_manager - INFO - ğŸ“¦ Loading Istanbul AI services...
2026-01-22 17:31:45,248 - services.service_manager - INFO - âœ… Restaurant service loaded
2026-01-22 17:31:45,253 - services.transportation_directions_service - INFO - âœ… Backend OSRM routing service imported successfully
2026-01-22 17:31:45,255 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine imported successfully
2026-01-22 17:31:45,255 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:31:45,257 - services.osrm_routing_service - INFO - âœ… OSRM routing cache enabled (Redis)
2026-01-22 17:31:45,257 - services.osrm_routing_service - INFO - OSRM Routing Service initialized (server: primary, profile: foot, cache: True)
2026-01-22 17:31:45,257 - services.transportation_directions_service - INFO - âœ… OSRM service initialized successfully
2026-01-22 17:31:45,257 - services.graph_routing_engine - INFO - ğŸ—ï¸ Building Istanbul transportation graph...
2026-01-22 17:31:45,258 - services.graph_routing_engine - INFO - ğŸ”„ Adding transfer connections...
2026-01-22 17:31:45,258 - services.graph_routing_engine - INFO - âœ… Added 154 transfer connections
2026-01-22 17:31:45,258 - services.graph_routing_engine - INFO - âœ… Graph built: 208 nodes, 528 edges
2026-01-22 17:31:45,258 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine initialized successfully
2026-01-22 17:31:45,258 - services.transportation_directions_service - INFO - âœ… Transportation Directions Service initialized
2026-01-22 17:31:45,258 - services.service_manager - INFO - âœ… Transportation service loaded
2026-01-22 17:31:45,259 - services.service_manager - INFO - âœ… Hidden gems service loaded
2026-01-22 17:31:45,261 - services.events_service - INFO - âœ… Loaded 45 Ä°KSV events from database
2026-01-22 17:31:45,261 - services.service_manager - INFO - âœ… Events service loaded
2026-01-22 17:31:45,262 - services.service_manager - INFO - âœ… Attractions service loaded
2026-01-22 17:31:45,263 - services.airport_transport_service - INFO - âœˆï¸ Istanbul Airport Transport Service initialized
2026-01-22 17:31:45,263 - services.airport_transport_service - INFO - âœˆï¸ Istanbul Airport Transport Service initialized
2026-01-22 17:31:45,263 - services.service_manager - INFO - âœ… Airport transport service loaded
2026-01-22 17:31:45,265 - services.service_manager - INFO - âœ… Daily life service loaded
2026-01-22 17:31:45,269 - services.service_manager - INFO - âœ… Info retrieval service loaded
2026-01-22 17:31:45,269 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:31:45,269 - api_clients.enhanced_weather - INFO - âœ… Weather API: Using Redis cache (persistent across restarts)
2026-01-22 17:31:45,269 - api_clients.enhanced_weather - WARNING - Weather API: Using fallback mode with enhanced mock data.
2026-01-22 17:31:45,269 - services.service_manager - INFO - âœ… Enhanced weather service loaded (real API with OpenWeatherMap)
2026-01-22 17:31:45,269 - services.entity_extractor - INFO - âœ… AdvancedEntityExtractor initialized
2026-01-22 17:31:45,269 - services.service_manager - INFO - âœ… Entity extractor loaded
2026-01-22 17:31:45,814 - services.enhanced_intent_classifier - WARNING - Smart fallback system not available
2026-01-22 17:31:45,819 - services.enhanced_intent_classifier - INFO - âœ… ML intent classifier trained successfully
2026-01-22 17:31:45,820 - services.service_manager - INFO - âœ… Intent classifier loaded
2026-01-22 17:31:45,822 - services.conversation_context_manager - INFO - âœ… ConversationContextManager initialized with Redis
2026-01-22 17:31:45,822 - services.service_manager - INFO - âœ… Context manager loaded
2026-01-22 17:31:45,823 - services.turkish_typo_corrector - INFO - âœ… TurkishTypoCorrector initialized
2026-01-22 17:31:45,823 - services.service_manager - INFO - âœ… Typo corrector loaded
2026-01-22 17:31:45,823 - services.service_manager - INFO - ğŸ‰ Service Manager initialized: 13/13 services active
2026-01-22 17:31:45,823 - core.startup_fixed - INFO - âœ… Service Manager initialized
2026-01-22 17:31:45,823 - core.startup_guard - INFO - âœ… multi_route marked as initialized
2026-01-22 17:31:45,823 - core.startup_fixed - INFO - ğŸ”„ Initializing Moovit-style multi-route system...
2026-01-22 17:31:45,824 - services.route_optimizer - INFO - âœ… Accessibility features available
2026-01-22 17:31:45,824 - services.route_optimizer - INFO - âœ… OpenAI available for route summaries
2026-01-22 17:31:45,825 - services.accessibility_features - INFO - âœ… Accessibility checker initialized with 59 stations
2026-01-22 17:31:45,825 - services.route_optimizer - INFO - âœ… Accessibility checker integrated with route optimizer
2026-01-22 17:31:45,825 - core.startup_fixed - INFO - âœ… Route Optimizer initialized
2026-01-22 17:31:45,825 - services.transportation_route_integration - INFO - âœ… Route optimizer imported successfully
2026-01-22 17:31:45,825 - services.transportation_route_integration - INFO - âœ… Transportation services imported successfully
2026-01-22 17:31:45,826 - services.transportation_rag_system - INFO - âœ… Transportation RAG: Redis connected for route caching
2026-01-22 17:31:45,829 - services.transportation_station_normalization - INFO - âœ… Station normalizer initialized: 264 stations, 17 lines
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO - âœ… Built station graph from canonical data: 264 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO - ğŸ“Š Station counts by line:
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   FERRY: 15 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M11: 9 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M1A: 18 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M1B: 13 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M2: 16 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M3: 19 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M4: 24 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M5: 20 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M6: 4 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M7: 17 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   M9: 2 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   MARMARAY: 43 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   T1: 31 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   T4: 22 stations
2026-01-22 17:31:45,829 - services.transportation_rag_system - INFO -   T5: 11 stations
2026-01-22 17:31:45,830 - services.transportation_rag_system - INFO - âœ… Transportation RAG initialized with complete Istanbul network
2026-01-22 17:31:45,830 - services.transportation_rag_system - INFO - âœ… Dijkstra routing enabled with realistic travel times
2026-01-22 17:31:45,830 - services.transportation_rag_system - INFO - âœ… Station/Line ID normalization enabled
2026-01-22 17:31:45,830 - services.transportation_rag_system - INFO - âœ… Route caching enabled with Redis
2026-01-22 17:31:45,830 - services.transportation_rag_system - INFO - âœ… Transportation RAG singleton initialized
2026-01-22 17:31:45,830 - services.redis_cache - INFO - âœ… Redis cache client created: localhost:6379 (timeout: 30s)
2026-01-22 17:31:45,830 - services.osrm_routing_service - INFO - âœ… OSRM routing cache enabled (Redis)
2026-01-22 17:31:45,830 - services.osrm_routing_service - INFO - OSRM Routing Service initialized (server: primary, profile: foot, cache: True)
2026-01-22 17:31:45,831 - services.transportation_directions_service - INFO - âœ… OSRM service initialized successfully
2026-01-22 17:31:45,831 - services.graph_routing_engine - INFO - ğŸ—ï¸ Building Istanbul transportation graph...
2026-01-22 17:31:45,831 - services.graph_routing_engine - INFO - ğŸ”„ Adding transfer connections...
2026-01-22 17:31:45,832 - services.graph_routing_engine - INFO - âœ… Added 154 transfer connections
2026-01-22 17:31:45,832 - services.graph_routing_engine - INFO - âœ… Graph built: 208 nodes, 528 edges
2026-01-22 17:31:45,832 - services.transportation_directions_service - INFO - âœ… Graph-based routing engine initialized successfully
2026-01-22 17:31:45,832 - services.transportation_directions_service - INFO - âœ… Transportation Directions Service initialized
2026-01-22 17:31:45,832 - services.transportation_route_integration - INFO - âœ… Transportation services initialized
2026-01-22 17:31:45,832 - services.route_optimizer - INFO - âœ… Accessibility checker integrated with route optimizer
2026-01-22 17:31:45,832 - services.route_optimizer - INFO - âœ… RouteOptimizer initialized
2026-01-22 17:31:45,832 - services.transportation_route_integration - INFO - âœ… Route optimizer initialized
2026-01-22 17:31:45,832 - services.transportation_route_integration - INFO - âœ… TransportationRouteIntegration initialized
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - âœ… Transportation Route Integration initialized
2026-01-22 17:31:45,832 - services.enhanced_map_visualization_service - INFO - âœ… Enhanced Map Visualization Service initialized with Route Integration
2026-01-22 17:31:45,832 - services.enhanced_map_visualization_service - INFO - âœ… Transportation RAG integrated
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - âœ… Enhanced Map Visualization Service initialized
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - ğŸ—ºï¸ Multi-route system ready - Moovit-level features enabled!
2026-01-22 17:31:45,832 - core.startup_guard - INFO - âœ… models marked as initialized
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - ğŸ”„ Starting background LLM initialization...
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - â­ï¸ Model preloading disabled (using RunPod LLM)
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - âœ… Dependencies ready after 0s
2026-01-22 17:31:45,832 - core.startup_fixed - INFO - ğŸ” DB initialized: True, Services initialized: True
2026-01-22 17:31:45,832 - services.llm.core - INFO - â„¹ï¸  USE_UNIFIED_LLM=true but llm_client provided, using provided client
2026-01-22 17:31:45,832 - services.llm.core - INFO - ğŸ›¡ï¸ Initializing resilience components...
2026-01-22 17:31:45,832 - services.llm.core - INFO - âœ… Resilience components initialized
2026-01-22 17:31:45,832 - services.llm.fuzzy_matcher - INFO - âœ… FuzzyMatcher initialized (threshold=85, phonetic=True)
2026-01-22 17:31:45,832 - services.llm.signals - INFO - âœ… Fuzzy matching enabled (phonetic search available)
2026-01-22 17:31:45,833 - services.model_cache - INFO - ğŸ“¦ ModelCache initialized
WARNING:  StatReload detected changes in 'services/llm/prompts.py'. Reloading...
2026-01-22 17:31:48,542 - services.model_cache - INFO - ğŸ”„ Loading SentenceTransformer: all-MiniLM-L6-v2
2026-01-22 17:31:50,923 - services.model_cache - INFO - âœ… SentenceTransformer loaded: all-MiniLM-L6-v2
2026-01-22 17:31:50,925 - services.llm.embedding_service - INFO - âœ… Loaded embedding model: lightweight (cached)
2026-01-22 17:31:51,816 - services.llm.embedding_service - INFO - âœ… Loaded intent examples for 6 intents
2026-01-22 17:31:51,816 - services.llm.embedding_service - INFO - âœ… EmbeddingService initialized (mode: lightweight, offline: False)
2026-01-22 17:31:51,816 - services.llm.signals - INFO - âœ… Semantic embeddings enabled: online
2026-01-22 17:31:51,816 - services.llm.istanbul_knowledge - INFO - âœ… Istanbul Knowledge initialized: 13 landmarks, 10 neighborhoods
2026-01-22 17:31:51,816 - services.llm.signals - INFO - âœ… Istanbul intelligence enabled: 13 landmarks
2026-01-22 17:31:51,826 - services.transportation_intent_classifier - INFO - âœ… Hybrid Intent Classifier initialized with embeddings
2026-01-22 17:31:51,827 - services.llm.signals - INFO - âœ… Hybrid transportation intent classifier enabled
2026-01-22 17:31:51,827 - services.llm.signals - INFO - âœ… Signal Detector initialized (fuzzy=True, context=True, embeddings=True, istanbul=True, transport_classifier=True)
2026-01-22 17:31:51,827 - services.llm.context - INFO - âœ… Context Builder initialized
2026-01-22 17:31:51,827 - services.llm.context - INFO -    ğŸ“¦ Service Manager available for enhanced context building
2026-01-22 17:31:51,827 - services.llm.prompts - INFO - âœ… Prompt Builder initialized
2026-01-22 17:31:51,830 - services.llm.feedback_trainer - INFO - Loaded 58 training samples
2026-01-22 17:31:51,830 - services.llm.feedback_trainer - INFO - âœ… FeedbackTrainer initialized with 58 existing samples
2026-01-22 17:31:51,830 - services.llm.analytics - INFO - âœ… Feedback loop enabled for continuous improvement
2026-01-22 17:31:51,830 - services.llm.analytics - INFO - âœ… Analytics Manager initialized
2026-01-22 17:31:51,830 - services.llm.query_enhancement - INFO - âœ… Query Enhancer initialized
2026-01-22 17:31:51,830 - services.llm.conversation - INFO - âœ… Conversation Manager initialized
2026-01-22 17:31:51,830 - services.llm.caching - INFO - âœ… Cache Manager initialized (semantic=enabled)
2026-01-22 17:31:51,830 - services.llm.experimentation - INFO - âœ… Experimentation Manager initialized (A/B=off)
2026-01-22 17:31:51,830 - services.llm.personalization - INFO - âœ… Personalization Engine initialized
2026-01-22 17:31:51,830 - services.llm.auto_tuning - INFO - âœ… Auto-Tuner initialized
2026-01-22 17:31:51,830 - services.llm.core - INFO - âœ… All subsystems initialized (including Phase 2 features)
2026-01-22 17:31:51,830 - services.llm.core - INFO - ğŸš€ Pure LLM Core initialized successfully
2026-01-22 17:31:51,830 - services.llm.core - INFO -    ğŸ¤– LLM Service: Legacy RunPodClient
2026-01-22 17:31:51,830 - services.llm.core - INFO -    ğŸ“¦ Service Manager: 13/13 services available
2026-01-22 17:31:51,830 - core.startup_fixed - INFO - âœ… Pure LLM Core initialized (background)
INFO:     Stopping reloader process [246]
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/multiprocessing/resource_tracker.py:224: UserWarning: resource_tracker: There appear to be 2 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
